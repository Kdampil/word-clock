<!-- Header -->
<header>
    <h1>
        <span class="editable-title" id="editable-title">üåç World Clock</span>
    </h1>
</header>

<div class="controls">
    <button class="add-btn" id="add-btn">üåê</button> <!-- Globe Icon -->
    <button class="gear-btn" id="gear-btn">‚öôÔ∏è</button>
    <button class="pin-btn" id="pin-btn">üìå</button>

    <!-- Time Zone Dropdown -->
    <div class="timezone-dropdown" id="timezone-dropdown">
        <select id="timezone-select">
            <option value="Etc/UTC">UTC (Coordinated Universal Time)</option>
            <option value="Etc/GMT+12">UTC-12:00 (Baker Island Time)</option>
            <option value="Etc/GMT+11">UTC-11:00 (Niue Time)</option>
            <option value="Etc/GMT+10">UTC-10:00 (Hawaii-Aleutian Standard Time)</option>
            <option value="Etc/GMT+9">UTC-09:00 (Alaska Standard Time)</option>
            <option value="Etc/GMT+8">UTC-08:00 (Pacific Standard Time)</option>
            <option value="Etc/GMT+7">UTC-07:00 (Mountain Standard Time)</option>
            <option value="Etc/GMT+6">UTC-06:00 (Central Standard Time)</option>
            <option value="Etc/GMT+5">UTC-05:00 (Eastern Standard Time)</option>
            <option value="Etc/GMT+4">UTC-04:00 (Atlantic Standard Time)</option>
            <option value="Etc/GMT+3">UTC-03:00 (Bras√≠lia Time)</option>
            <option value="Etc/GMT+2">UTC-02:00 (South Georgia Time)</option>
            <option value="Etc/GMT+1">UTC-01:00 (Cape Verde Time)</option>
            <option value="Etc/GMT">UTC¬±00:00 (Greenwich Mean Time)</option>
            <option value="Etc/GMT-1">UTC+01:00 (Central European Time)</option>
            <option value="Etc/GMT-2">UTC+02:00 (Eastern European Time)</option>
            <option value="Etc/GMT-3">UTC+03:00 (East Africa Time)</option>
            <option value="Etc/GMT-4">UTC+04:00 (Gulf Standard Time)</option>
            <option value="Etc/GMT-5">UTC+05:00 (Pakistan Standard Time)</option>
            <option value="Etc/GMT-6">UTC+06:00 (Bangladesh Standard Time)</option>
            <option value="Etc/GMT-7">UTC+07:00 (Indochina Time)</option>
            <option value="Etc/GMT-8">UTC+08:00 (China Standard Time)</option>
            <option value="Etc/GMT-9">UTC+09:00 (Japan Standard Time)</option>
            <option value="Etc/GMT-10">UTC+10:00 (Australian Eastern Standard Time)</option>
            <option value="Etc/GMT-11">UTC+11:00 (Solomon Islands Time)</option>
            <option value="Etc/GMT-12">UTC+12:00 (New Zealand Standard Time)</option>
            <option value="Etc/GMT-13">UTC+13:00 (Tonga Time)</option>
            <option value="Etc/GMT-14">UTC+14:00 (Line Islands Time)</option>
        </select>
        <button id="confirm-timezone">Add</button>
    </div>
</div>

<main>
    <div class="time-zone-container" id="time-zone-container"></div>
</main>

<script>
    const { ipcRenderer } = require('electron');

    // Minimize and Close Buttons
    document.getElementById('minimize-btn').addEventListener('click', () => {
        ipcRenderer.send('minimize-window');
    });

    document.getElementById('close-btn').addEventListener('click', () => {
        ipcRenderer.send('close-window');
    });

    // Toggle "Always on Top"
    const pinBtn = document.getElementById('pin-btn');
    pinBtn.addEventListener('click', () => {
        const isActive = pinBtn.classList.toggle('active');
        const icon = isActive ? 'üìç' : 'üìå';
        pinBtn.textContent = icon;

        // Send IPC message to main process
        ipcRenderer.send('set-always-on-top', isActive);
    });

// Open Theme Customization Pop-Out Window
const gearBtn = document.getElementById('gear-btn');
gearBtn.addEventListener('click', () => {
    ipcRenderer.send('open-theme-window');
});

// Add a new time zone
document.getElementById('confirm-timezone').addEventListener('click', () => {
    const selectedTimeZone = timezoneSelect.value;
    const optionText = timezoneSelect.options[timezoneSelect.selectedIndex].text;

    // Extract just the descriptive name (e.g., "Hawaii-Aleutian Standard Time")
    const displayName = optionText.split(' (')[1]?.slice(0, -1) || optionText;

    // Check if the time zone already exists
    const exists = savedTimeZones.some((tz) => tz.timeZone === selectedTimeZone);
    if (!exists) {
        const newTimeZone = { timeZone: selectedTimeZone, displayName };
        savedTimeZones.push(newTimeZone);
        localStorage.setItem('timeZones', JSON.stringify(savedTimeZones));
        addTimeZone(selectedTimeZone, displayName);

        // Dynamically adjust window height
        const windowHeight = 424 + savedTimeZones.length * 60; // Adjust height based on time zones
        ipcRenderer.send('resize-window', windowHeight);
    }

    timezoneDropdown.style.display = 'none'; // Hide dropdown after adding
});

// Function to add a time zone to the UI
function addTimeZone(timeZone, displayName) {
    const timeZoneDiv = document.createElement('div');
    timeZoneDiv.classList.add('time-zone');
    timeZoneDiv.dataset.timeZone = timeZone;

    timeZoneDiv.innerHTML = `
        <h2><span contenteditable="true" class="editable-name">${displayName}</span></h2>
        <p class="time">--:--:--</p>
        <button class="delete-btn" onclick="deleteTimeZone('${timeZone}')">&times;</button>
    `;

    const editableNameSpan = timeZoneDiv.querySelector('.editable-name');
    editableNameSpan.addEventListener('blur', () => {
        const updatedDisplayName = editableNameSpan.textContent;
        const timeZoneIndex = savedTimeZones.findIndex((tz) => tz.timeZone === timeZone);
        if (timeZoneIndex !== -1) {
            savedTimeZones[timeZoneIndex].displayName = updatedDisplayName;
            localStorage.setItem('timeZones', JSON.stringify(savedTimeZones));
        }
    });

    timeZoneContainer.appendChild(timeZoneDiv);
}

// Function to delete a time zone
window.deleteTimeZone = function (timeZone) {
    savedTimeZones = savedTimeZones.filter((tz) => tz.timeZone !== timeZone);
    localStorage.setItem('timeZones', JSON.stringify(savedTimeZones));
    const timeZoneDiv = document.querySelector(`[data-time-zone="${timeZone}"]`);
    timeZoneDiv.remove();

    // Dynamically adjust window height
    const windowHeight = 424 + savedTimeZones.length * 60; // Adjust height based on time zones
    ipcRenderer.send('resize-window', windowHeight);
};

// Update time for all time zones every second
function updateTime() {
    document.querySelectorAll('.time-zone').forEach((tzDiv) => {
        const timeZone = tzDiv.dataset.timeZone;
        const timeElement = tzDiv.querySelector('.time');
        const now = new Date();
        const time = now.toLocaleTimeString('en-US', { timeZone });
        timeElement.textContent = time;
    });
}

setInterval(updateTime, 1000);
updateTime();

// Apply theme updates from main process
ipcRenderer.on('apply-theme', (event, { property, value }) => {
    document.documentElement.style.setProperty(`--${property}`, value);

    // Save updated theme to localStorage
    const savedTheme = JSON.parse(localStorage.getItem('theme')) || {};
    savedTheme[property] = value;
    localStorage.setItem('theme', JSON.stringify(savedTheme));
});
</script>
</body>
</html>
